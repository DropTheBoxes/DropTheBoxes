<!-- <!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>인증번호 입력</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='verify.css') }}">
</head>
<body>
    <div class="title">휴대폰에 전송된 비밀번호 4자리를 입력하세요.</div>

    <div class="input-box" id="pinDisplay">____</div>

    <div class="keypad">
        {% for num in range(1, 10) %}
            <button onclick="appendPin('{{ num }}')">{{ num }}</button>
        {% endfor %}
        <button onclick="deletePin()">삭제</button>
        <button onclick="appendPin('0')">0</button>
        <button onclick="submitPin()">확인</button>
    </div>

    <div class="bottom-nav">
        <a href="/">처음으로</a>
        <a href="/user_home">이전으로</a>
    </div>

    <script>
        // 사용자가 입력한 PIN 번호를 저장할 변수 (문자열 형태)
        let pin = "";
    
        // 숫자 버튼을 눌렀을 때 호출되는 함수
        function appendPin(num) {
            // PIN이 4자리가 되기 전까지만 숫자를 추가함
            if (pin.length < 4) {
                pin += num;           // 입력된 숫자를 문자열로 추가
                updateDisplay();      // 화면에 표시되는 숫자를 업데이트
            }
        }
    
        // '삭제' 버튼을 눌렀을 때 호출되는 함수
        function deletePin() {
            // 마지막 숫자 하나를 제거
            pin = pin.slice(0, -1);
            updateDisplay();  // 화면에 표시되는 숫자를 업데이트
        }
    
        // 화면에 PIN 상태를 표시하는 함수
        function updateDisplay() {
            // pin이 4자리가 되지 않으면 나머지는 밑줄(_)로 채워서 표시
            // 예: "12" → "12__"
            document.getElementById('pinDisplay').innerText =
                pin.padEnd(4, '_');
        }
    
        // '확인' 버튼을 눌렀을 때 호출되는 함수
        function submitPin() {
            // PIN이 정확히 4자리인 경우
            if (pin.length === 4) {
                alert("입력한 인증번호: " + pin);  // 입력값을 알림창으로 보여줌
                // TODO: 실제 서버로 인증번호를 전송하는 로직을 여기에 추가 가능
            } else {
                // 4자리가 안되었을 경우 경고 메시지 표시
                alert("4자리를 모두 입력해주세요.");
            }
        }
    </script>
    
</body>
</html> -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>인증번호 입력</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='verify.css') }}">
</head>
<body>
    <div class="title">휴대폰에 전송된 비밀번호 4자리를 입력하세요.</div>

    <div class="input-box" id="pinDisplay">____</div>

    <!-- lockerId 숨김 -->
    <input type="hidden" id="lockerId" value="{{ locker_id }}">

    <div class="keypad">
        {% for num in range(1, 10) %}
            <button onclick="appendPin('{{ num }}')">{{ num }}</button>
        {% endfor %}
        <button onclick="deletePin()">삭제</button>
        <button onclick="appendPin('0')">0</button>
        <button onclick="submitPin()">확인</button>
    </div>

    <div class="bottom-nav">
        <a href="/">처음으로</a>
        <a href="/user_home">이전으로</a>
    </div>

    <script>
        let pin = "";

        function appendPin(num) {
            if (pin.length < 4) {
                pin += num;
                updateDisplay();
            }
        }

        function deletePin() {
            pin = pin.slice(0, -1);
            updateDisplay();
        }

        function updateDisplay() {
            document.getElementById('pinDisplay').innerText = pin.padEnd(4, '_');
        }

        function submitPin() {
            if (pin.length === 4) {
                const lockerId = document.getElementById('lockerId').value;

                fetch('/verify_pin', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams({
                        pin: pin,
                        locker_id: lockerId
                    })
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    if (data.success) {
                        window.location.href = '/user_home';
                    } else {
                        if (data.new_password) {
                            alert("새 비밀번호: " + data.new_password);
                        }
                    }
                })
                .catch(error => {
                    console.error('에러:', error);
                    alert("서버 통신 실패");
                });
            } else {
                alert("4자리를 모두 입력해주세요.");
            }
        }
    </script>

</body>
</html>
